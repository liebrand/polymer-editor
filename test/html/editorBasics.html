<!doctype html>
<html>
<head>
  <title>polymer-editor</title>

  <script src="../../third_party/when/when.js"></script>

  <script src="../../../platform/platform.js"></script>
  <script src="../../../tools/test/htmltest.js"></script>
  <script src="../../../tools/test/chai/chai.js"></script>

  <script src="../utils/keyCodeMap.js"></script>
  <script src="../utils/eventUtils.js"></script>
  <script src="../utils/text.js"></script>
  <script src="../utils/keys.js"></script>
  <script src="../utils/keyboard.js"></script>

  <link rel="import" href="../../core/polymer-editor.html"/>

</head>
<body>

   <polymer-editor id="my-editor">
    <polymer-editor-content>hello</polymer-editor-content>
  </polymer-editor>

  <script>

    // hard codes the element placement based on above html
    function placeCaret(offset) {
      var editor = document.querySelector('#my-editor');
      var content = editor.firstElementChild;
      var contentTextNode = content.firstChild;
      var range = document.createRange();
      range.setStart(contentTextNode, offset);
      range.setEnd(contentTextNode, offset);
      window.getSelection().removeAllRanges();
      window.getSelection().addRange(range);
    }

    var assert = chai.assert;
    document.addEventListener('WebComponentsReady', function() {

      // make sure we have an editor - should probably test more than
      // just the fact the element is defined... ?
      var editor = document.querySelector('#my-editor');
      assert.isDefined(editor, 'our editor is defined');

      // test insert text at start
      placeCaret(0);
      Keyboard.type(text('foobar')).then(function(a) {
        assert.equal(editor.innerText, 'foobarhello');
      }).then(function() {

        // test insert text in the middle
        placeCaret(6);
        return Keyboard.type(text('eggs'));
      }).then(function() {
        assert.equal(editor.innerText, 'foobareggshello');
      }).then(function() {

        // test insert text at the end
        placeCaret(editor.innerText.length);
        return Keyboard.type(text('world'));
      }).then(function() {
        assert.equal(editor.innerText, 'foobareggshelloworld');
        done();
      }).then(function() {

        // test backspace
        placeCaret(6);
        return Keyboard.type(keys('‚üµ').repeat(6));
      }).then(function() {
        assert.equal(editor.innerText, 'eggshelloworld');
      })
      .catch(onerror);

    });
  </script>
</body>
</html>
